<!DOCTYPE html>
<html>
  <head>
    <title>CandyOrder</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <%= render 'layouts/header' %>
    <%= yield %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
    $(function(){
    	var number,total_numner;
    	var max = 1000; //合計最大数
    	var $input = $('#count .number'); //カウントする箇所
    	var $plus = $('#count .plus'); //アップボタン
    	var $minus = $('#count .minus'); //ダウンボタン
    	//合計カウント用関数
    	function total() {
    		total_numner = 0;
    		$input.each(function(val) {
    			val = Number($(this).val());
    			total_numner += val;
    		});
    		return total_numner;
    	}
    	//ロード時
    	$(window).on('load', function() {
    		$input.each(function() {
    			number = Number($(this).val());
    			if (number == max) {
    				$(this).next($plus).prop("disabled", true);
    			} else if (number == 0) {
    				$(this).prev($minus).prop("disabled", true);
    			}
    		});
    		total();
    		if (total_numner == max) {
    			$plus.prop("disabled", true);
    		} else {
    			$plus.prop("disabled", false);
    		}
    	});
    	//ダウンボタンクリック時
    	$minus.on('click', function() {
    		total();
    		number = Number($(this).next($input).val());
    		if (number > 0) {
    			$(this).next($input).val(number - 1);
    			if ((number - 1) == 0) {
    			$(this).prop("disabled", true);
    			}
    			$(this).next().next($plus).prop("disabled", false);
    		} else {
    			$(this).prop("disabled", true);
    		}
    		total();
    		if (total_numner < max) {
    			$plus.prop("disabled", false);
    		}
    	});
    	//アップボタンクリック時
    	$plus.on('click', function() {
    		number = Number($(this).prev($input).val());
    		if (number < max) {
    			$(this).prev($input).val(number + 1);
    			if ((number + 1) == max) {
    			$(this).prop("disabled", true);
    			}
    			$(this).prev().prev($minus).prop("disabled", false);
    		} else {
    			$(this).prop("disabled", true);
    		}
    		total();
    		if (total_numner == max) {
    			$plus.prop("disabled", true);
    		} else {
    			$plus.prop("disabled", false);
    		}
    	});
    });
    </script>
  </body>
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-6 offset-5">
          <h4>©CandyOrder</h4>
        </div>
      </div>
    </div>
  </footer>
</html>
